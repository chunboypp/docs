# DNS

## dns协议

​	使用层次地址结构，对域名进行解析。提供域名到ip的映射

域名层次顶级有ICANN(互联网名称与数字地址分配机构)，负责管理，每个顶级域名又可划分一些子域，子域又可划分子域。即二级域名三级域名。依次延伸，域名结构就是一个树状结构。

dns又叫域名资源记录，其格式如下

```
Domain_name Time_to_live Class Type Value
```

| Domain_name  | 指出这条记录适用于哪个域名     |
| ------------ | ------------------------------ |
| Time_to_live | 记录的生存周期，即可以缓存多久 |
| Class        | 一般总是IN                     |
| Type         | 记录的类型                     |
| Value        | 记录的值。A 标识是一个IPv4地址 |

| 记录类型Type值 | 含义                             |
| -------------- | -------------------------------- |
| A              | 主机的IPV4地址                   |
| AAAA           | 主机的ipv6地址                   |
| NS             | 该域名所在的权威域名服务器       |
| MX             | 接受特定域名电子邮件的服务器域名 |
| CNAME          | 当前域名的一个别名               |

一个地址根据域名进行划分，根据不同的域名划分不同的区域（域名空间），每一个区域，关联的很多域名服务器，一主（master）多从（slave）结构，这些关联的域名服务器称为权威域名服务器

权威域名服务器保存内容：

1. 该区域内所有域名的域名资源记录
2. 父区域和子区域的域名服务器对应的域名资源记录

各个权威域名之间相互独立，是通过回溯 根域名服务器，找到其他域名资源。

从根域名开始构建一个查找数

 			根

​	com				cn

## 域名解析

​		计算机联网后会获取一个默认域名服务器，也可以设置自己信任的域名服务器。区域域名空间相互独立。如果在本地区域域名空间没有找到对应的ip，域名位于树的层级结构中，则询问自己的父节点，如果没有一直询问到根域名，然后再根据根域名一层层向下查找。

​	计算机会将已经解析过的域名缓存到本地，缓存时长通过在域名资源后加Time_to_live（表明可缓存多久）进行控制，同样域名服务器也可以进行已解析域名的缓存

### 域名解析命令

#### dig命令

dig（domain information groper）是unix/bsd自带dns解析工具

用法：

1. 查询域名对应的ip       dig 域名 -t A +short

2. 查询ip对应的域名  dig -x ip地址 +short  

3. 解析路径查询，解析域名可能经过的所有域名服务器    dig 域名  +trace

   seveas提供可视化查询工具：dnsgraph,绘制根域名到指定域名可能访问域名路径

   

   
#### nslookup 工具也可以解析，自行查看

#### dns劫持

   在访问域名服务器的过程中，被其它非域名服务器劫持更改域名解析结果，返回错误的地址

   nslookup 域名  返回域名地址

   whois ip地址   查看地址是否合法

   noslookup 域名  域名服务器地址   通过指定域名服务器地址来规避非法拦截

####    dns欺骗

用假的dms应答来欺骗用户计算机，抛弃真正的应答。构建正确的数据包以达到欺骗。

   

   



文章来源：http://selfboot.cn/2015/11/05/dns_theory/

