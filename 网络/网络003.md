# 协议

| 应用层 Application Layer (有的分七层，包括 会话层  表示层  应用层) |
| ------------------------------------------------------------ |
| 传输层 Transport Layer                                       |
| 网络层 Network Layer                                         |
| 链路层 Link Layer                                            |
| 物理层 Physical Layer                                        |

各层之间通过不同的协议进行通讯

## 物理层

光纤  电信号 等等。通过物理实体传输 0 1信号

## 链路层

### 以太网协议：

一组电信号（0 1）构成一个数据包，叫做帧

帧的结构

| Head            | Data                     |
| --------------- | ------------------------ |
| 固定长度 18字节 | 最短46字节，最长1500字节 |

所以帧最短为64字节，最长为1518字节，数据太长就要拆包

### Mac地址

设备上网必要要有网卡，数据在网卡之间进行传输。网卡地址就是mac地址

mac地址在网卡出厂时就确定，不重复，长度为48个二进制位（6字节 1字节=8bit）,通常用12个 16进制数表示

mac地址格式

##-##-##-##-##-##

前6位：厂商编号。后6位：网卡流水编号

### 广播

mac地址之间通过arp协议在内网进行通信。

机器1 向机器 2通信，会向内网所有机器发送消息，收到消息的机器会比对消息头的 头部 mac地址是否和自己的mac地址相同，相同则接收处理。不同则丢弃

## 网络层 IP

mac地址广播只适合内网，外网需要通过ip进行 路由。故计算机的两个地址 mac地址（厂商分配），ip地址（网络管理员分配）

### ip协议

根据ip协议发送的数据叫ip数据包

ip数据包格式

|        |      |
| ------ | ---- |
| header | data |

放入以太网数据包后

header(以太网数据包头)|( header(ip数据包头) data )

ip协议使不在同一个子网的机器进行通信。mac地址是在以太网数据包头中，如何找到目的ip(在ip数据包头)的mac，到达目的子网，通过arp协议广播，目的mac地址写的是FF:FF:FF:FF(广播地址)，内网机器收到消息后，比对ip数据包头中的ip地址是否和自己的相同，相同则接收，不同则丢弃

## 传输层 TCP UDP

mac地址和ip使两台机器通信，但是每台机器上有很多进程（程序），通过端口来获取自己需要的数据，端口 介于0-65535之间（即2的16次方，16个二进制）。0-1023被系统使用。

传输层就是建立端口与端口的通信。unix把主机+端口称为套接字（socket） 

### udp协议

udp数据包格式：

head|data

udp数据包放入ip数据包的 data部分

head(以太网)|(head(ip数据包)|(head(udp数据包)|data)

head 8字节长，data部分不超过65535字节

### tcp协议

udp可靠性差，不保证数据是否传输到

tcp为了可靠传输。实现复杂

tcp数据包和udp数据包格式一样。也是放在ip的data部分

