# 网络协议

## 网络协议是什么

协议就是告诉彼此对方，按照约定解析发送内容。

## 协议实现

### 基本实现

ASN.1（一种ISO/ITU-T）标准，其中一种编码BER(basic encoding rules),使用三元组编码，简称TLV编码

每个字段的数据结构如下

|     T      |       L        |       V        |
| :--------: | :------------: | :------------: |
| Tag octets | Length  octets | content octets |

字段也可以嵌套 在V  内容上进行嵌套

TL(TL(TLV))TLV

TLV缺点：冗余TL,如果协议都是基本类型则比较浪费空间，不具有自解释性和结构化。需要双方事先约定好描述文档

### 增加自解释性

增加Type 类型字段

| 类型   | Type值 | 类型描述             |
| ------ | ------ | -------------------- |
| bool   | 1      | 布尔值               |
| int8   | 2      | 带符号的一个字符     |
| uint8  | 3      | 带符号的一个字符     |
| int16  | 4      | 16位有符号整形       |
| uint16 | 5      | 16位无符号整形       |
| int32  | 6      | 32位有符号整形       |
| uint32 | 7      | 32位无符号整形       |
| ...    |        |                      |
| string | 12     | 字符或二进制序列     |
| struct | 13     | 自定义结构，嵌套使用 |
| list   | 14     | 有序列表             |
| map    | 15     | 无序列表             |

### 跨语言

IDL(interface description language) 描述性语言。通过规约和约束，生成各编程语言代码

### 协议上的其它特性

1压缩。如：int类型，很多值都在127以下，则不用每个int都占用4个字节，可以占用 1/2/3/4个字节

2reiur/option 特性。1对于有些不是必须且没有值的字段，则不用一起打包。2对于必须字段，增加约束，加强校验

