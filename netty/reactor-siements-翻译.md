# Reactor

用于同步事件的多路分解和调度句柄的对象行为模式。（对同步事件进行分解，进行调度）



​	本文的早期版本出现在“程序设计的模式语言” ISBN 0- 201-6073-4一书中，该书由Jim Coplien和Douglas C. Schmidt编辑，由Addison-Wesley出版，1995年。

## 1 Intent（意图）

​		Reactor设计模式处理由一个或多个客户端同时交付给应用程序的服务请求。应用程序中的每个服务可能包含几种方法，并由负责分派特定于服务的请求的单独事件处理程序表示。由初始化调度程序执行的事件处理程序的调度，该调度程序管理已注册的事件处理程序。服务请求的多路分解是由同步事件多路分解器执行的。

## 2 也称为调度，通知程序



## 3 Example（例子）

​	为了说明Reactor模式，请考虑图1所示的事件驱动服务器的分布式日志记录服务。客户端应用程序使用日志记录服务来记录有关其在分布式环境中的状态的信息。该状态信息通常包括错误通知，调试跟踪和性能报告。日志记录被发送到中央日志服务器，该服务器可以将记录写入各种输出设备，例如控制台，打印机，文件或网络管理数据库。

![image-20200109184826687](image/image-20200109184826687.png)

​																		图 1: 分布式日志服务

​		图1中所示的日志记录服务器处理客户端发送的日志记录和连接请求。日志记录和连接请求可以同时到达多个句柄。句柄标识OS内管理的网络通信资源。 

​		日志记录服务器使用面向连接的协议（例如TCP [1]）与客户端进行通信。想要记录数据的客户端必须首先将连接请求发送到服务器。服务器使用句柄工厂等待这些连接请求，该工厂监听客户端已知的地址。当连接请求到达时，句柄工厂通过创建代表连接端点的新句柄来建立客户端与服务器之间的连接。该句柄返回到服务器，然后服务器等待客户端服务请求到达该句柄。客户端连接后，他们可以将日志记录同时发送到服务器。服务器通过连接的套接字句柄接收这些记录。

​		开发并发日志服务器的最直观的方法也许是使用可以同时处理多个客户端的多个线程，如图2所示。该方法同步接受网络连接并产生“每个连接线程”以处理客户端日志记录。

​	<img src="../image/image-20200131121127683.png" alt="image-20200131121127683" style="zoom:70%;" />

​										图2：多线程日志记录服务器

​		但是，使用多线程在服务器中实现日志记录的处理无法解决以下问题：  

- 效率：线程可能由于上下文切换，同步和数据移动而导致性能不佳

- 编程简单：线程可能需要复杂的并发控制方案

- 可移植性：线程并非在所有OS平台上都可用。   

  由于这些缺点，多线程通常不是开发并发日志服务器的最有效或最不复杂的解决方案

### 4上下文（Context）

​		分布式系统中的服务器应用程序，同时从一个或多个客户端接收事件  

### 5问题

​		但是，在调用特定服务之前，服务器应用程序必须解复用并将每个传入请求分派到其相应的服务提供者。开发有效的服务器机制以多路分解和分发客户端请求，需要解决以下问题：

- 可用性：即使正在等待其他请求到达，服务器也必须能够处理传入的请求。特别是，服务器不得在排除其他事件源的情况下无限期地阻塞任何单一事件源，因为这可能会大大延迟对其他客户端的响应。
- 效率：服务器必须最小化延迟，最大化吞吐量，并避免不必要地利用CPU。
- 编程简单：服务器的设计应简化适当的并发策略的使用
- 适配性：集成新的或改进的服务，例如更改消息格式或添加服务器端缓存，应该为现有代码带来最少的修改和维护成本。例如，实现新的应用程序服务不应要求修改通用事件多路分解和调度机制。
- 可移植性：将服务器移植到新的OS平台上不需要花费很多精力

