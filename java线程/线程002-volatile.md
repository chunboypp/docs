cpu通过访问缓存实现访问效率，会导致数据不一致的问题

解决数据不一致的方法：

1总线加锁-性能消耗大

2缓存一致性协议



并发编程中的三个概念

​	原子性：在一次操作中，要么全部成功，要么全部失败

​	可见性 ：前一步操作的结果，对后一步操作可见

​	有序性：防止编译器和处理器重排序。通过内存屏障实现（通过编译的lock指令）

编译器重排序：在不改变单线程程序的语义前提下，可以改变语句之间的执行顺序

处理起重排序：对于不存在数据依赖的语句，处理器可以改变对应机器指令的执行顺序



![屏幕快照 2019-08-04 下午11.15.50](../image/屏幕快照 2019-08-04 下午11.15.50-4931877.png)

!屏幕快照 2019-08-04 下午11.10.40](../image/屏幕快照 2019-08-04 下午11.10.40.png)

![屏幕快照 2019-08-04 下午11.15.50](../image/屏幕快照 2019-08-04 下午11.15.50.png)





As-if-serial 在不改变执行结果的前提下，可进行重排序。单线程保证程序执行结果是预期的结果，多线程不保证





